<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Fantasy Team - El7amla Fantasy League</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&family=Inter:wght@500;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      background: linear-gradient(135deg, #0a0a1a, #1a1f3b);
      color: #fff;
      min-height: 100vh;
      overflow-x: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    header {
      background: #0f172a;
      padding: 18px 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.6);
      width: 100%;
    }

    header h1 {
      font-family: 'Orbitron', sans-serif;
      font-size: 22px;
      color: #60a5fa;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    header img {
      height: 40px;
    }

    nav a {
      color: #93c5fd;
      text-decoration: none;
      font-weight: bold;
      margin-left: 25px;
      transition: 0.3s;
    }

    nav a:hover {
      color: #fff;
    }

    .container {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 40px;
      width: 100%;
      max-width: 1300px;
      padding: 40px 20px;
    }

    .main-content {
      flex: 1;
      text-align: center;
    }

    .main-content h2 {
      color: #60a5fa;
      margin-bottom: 20px;
    }

    input[type="text"] {
      padding: 10px 15px;
      border-radius: 6px;
      border: none;
      width: 200px;
      outline: none;
      font-size: 16px;
    }

    button {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      background-color: #2563eb;
      color: white;
      font-size: 15px;
      margin-left: 10px;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover {
      background-color: #1d4ed8;
    }

    #pitch {
      margin-top: 40px;
      background: radial-gradient(circle at center, #1e293b 0%, #0f172a 100%);
      border-radius: 16px;
      padding: 40px 20px;
      box-shadow: 0 0 30px rgba(0,0,0,0.6);
      display: grid;
      grid-template-rows: repeat(4, auto);
      gap: 20px;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
      position: relative;
    }

    .row {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .player {
      background: #1e40af;
      border-radius: 10px;
      padding: 10px;
      width: 100px;
      text-align: center;
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
      transition: 0.3s;
      cursor: pointer;
    }

    .player:hover {
      background: #3b82f6;
      transform: translateY(-3px);
    }

    .player img {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      object-fit: cover;
    }

    .player-name {
      font-size: 13px;
      font-weight: 600;
      margin-top: 6px;
    }

    .player-team {
      font-size: 11px;
      color: #dbeafe;
    }

    .player-points {
      font-size: 13px;
      margin-top: 4px;
      color: #22c55e;
      font-weight: 600;
    }

    #bench {
      margin-top: 40px;
    }

    #bench h3 {
      color: #60a5fa;
      margin-bottom: 10px;
    }

    #error {
      color: #f87171;
      margin-top: 15px;
    }

    /* Sidebar for player info */
    #player-info {
      position: fixed;
      top: 0;
      right: -400px;
      width: 350px;
      height: 100%;
      background: #0f172a;
      box-shadow: -4px 0 15px rgba(0,0,0,0.7);
      padding: 30px 20px;
      transition: 0.4s ease;
      overflow-y: auto;
      z-index: 999;
    }

    #player-info.active {
      right: 0;
    }

    #player-info h3 {
      font-family: 'Orbitron', sans-serif;
      color: #60a5fa;
      margin-bottom: 15px;
    }

    .info-line {
      margin: 10px 0;
      font-size: 15px;
    }

    .close-btn {
      background: none;
      color: #f87171;
      border: none;
      font-size: 18px;
      cursor: pointer;
      position: absolute;
      top: 10px;
      right: 15px;
    }

    .player-photo {
      width: 100%;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.6);
      margin-bottom: 15px;
    }

    /* Manager info box */
    #manager-info {
      width: 320px;
      background: #0f172a;
      border-radius: 16px;
      padding: 25px 20px;
      box-shadow: 0 0 20px rgba(0,0,0,0.6);
      position: sticky;
      top: 30px;
      height: fit-content;
    }

    #manager-info h3 {
      font-family: 'Orbitron', sans-serif;
      color: #60a5fa;
      border-bottom: 2px solid #1e3a8a;
      padding-bottom: 8px;
      margin-bottom: 15px;
    }

    .manager-line {
      font-size: 15px;
      margin: 10px 0;
    }

    @media (max-width: 900px) {
      .container {
        flex-direction: column;
        align-items: center;
      }

      #manager-info {
        width: 90%;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1><img src="el7amla_logo.png" alt="Logo"> El7amla Fantasy League</h1>
    <nav>
      <a href="index.html">Home</a>
      <a href="teams.html">Teams</a>
      <a href="standings.html">Standings</a>
      <a href="fixtures.html">Fixtures</a>
    </nav>
  </header>

  <div class="container">
    <div class="main-content">
      <h2>View Your Fantasy Team</h2>
      <input type="text" id="managerId" placeholder="Enter Your FPL ID">
      <button onclick="loadTeam()">Show My Team</button>
      <div id="error"></div>
      <div id="pitch"></div>
      <div id="bench"></div>
    </div>

    <div id="manager-info" style="display:none;">
      <h3>Manager Info</h3>
      <div id="manager-name" class="manager-line"></div>
      <div id="manager-points" class="manager-line"></div>
      <div id="manager-rank" class="manager-line"></div>
      <div id="manager-gw" class="manager-line"></div>
      <div id="manager-years" class="manager-line"></div>
    </div>
  </div>

  <div id="player-info">
    <button class="close-btn" onclick="closeSidebar()">‚úñ</button>
    <h3>Player Info</h3>
    <div id="player-details"></div>
  </div>

  <script>
    const PROXY = "https://corsproxy.io/?";

    async function fetchJSON(url) {
      const res = await fetch(PROXY + encodeURIComponent(url));
      if (!res.ok) throw new Error("Failed to fetch data");
      return await res.json();
    }

    async function loadTeam() {
      const id = document.getElementById("managerId").value.trim();
      const errorDiv = document.getElementById("error");
      const pitch = document.getElementById("pitch");
      const bench = document.getElementById("bench");
      const managerBox = document.getElementById("manager-info");
      pitch.innerHTML = "";
      bench.innerHTML = "";
      errorDiv.textContent = "";
      managerBox.style.display = "none";

      if (!id) {
        errorDiv.textContent = "‚ö†Ô∏è Please enter your ID.";
        return;
      }

      try {
        const bootstrap = await fetchJSON("https://fantasy.premierleague.com/api/bootstrap-static/");
        const currentEvent = bootstrap.events.find(e => e.is_current)?.id || 1;

        const [picksData, managerData] = await Promise.all([
          fetchJSON(`https://fantasy.premierleague.com/api/entry/${id}/event/${currentEvent}/picks/`),
          fetchJSON(`https://fantasy.premierleague.com/api/entry/${id}/`)
        ]);

        // manager info
        document.getElementById("manager-name").innerHTML = `üë§ <strong>${managerData.player_first_name} ${managerData.player_last_name}</strong>`;
        document.getElementById("manager-points").innerHTML = `üèÜ Total Points: <strong>${managerData.summary_overall_points}</strong>`;
        document.getElementById("manager-gw").innerHTML = `üéØ GW Points: <strong>${managerData.summary_event_points}</strong>`;
        document.getElementById("manager-rank").innerHTML = `üìä Overall Rank: <strong>${managerData.summary_overall_rank}</strong>`;
        document.getElementById("manager-years").innerHTML = `‚è≥ Started Playing: <strong>${managerData.joined_time.split('-')[0]}</strong>`;
        managerBox.style.display = "block";

        // players render
        const picks = picksData.picks || [];
        const elementsMap = {};
        bootstrap.elements.forEach(e => elementsMap[e.id] = e);
        const starting = picks.filter(p => p.position <= 11);
        const benchPlayers = picks.filter(p => p.position > 11);

        const gk = [], def = [], mid = [], fwd = [];
        starting.forEach(p => {
          const el = elementsMap[p.element];
          if (!el) return;
          const player = { ...el, is_captain: p.is_captain };
          if (el.element_type === 1) gk.push(player);
          else if (el.element_type === 2) def.push(player);
          else if (el.element_type === 3) mid.push(player);
          else fwd.push(player);
        });

        const rows = [gk, def, mid, fwd];
        rows.forEach(row => {
          const div = document.createElement("div");
          div.classList.add("row");
          row.forEach(p => {
            const pl = document.createElement("div");
            pl.classList.add("player");
            pl.innerHTML = `
              <img src="https://resources.premierleague.com/premierleague/photos/players/110x140/p${p.code}.png"
                   onerror="this.src='https://cdn-icons-png.flaticon.com/512/3135/3135768.png'">
              <div class="player-name">${p.web_name}${p.is_captain ? " (C)" : ""}</div>
              <div class="player-team">${bootstrap.teams[p.team - 1]?.name || ''}</div>
              <div class="player-points">Pts: ${p.event_points || 0}</div>
            `;
            pl.onclick = () => showPlayerInfo(p.id, p.web_name, p.code);
            div.appendChild(pl);
          });
          pitch.appendChild(div);
        });

      } catch (err) {
        console.error(err);
        errorDiv.textContent = "‚ö†Ô∏è Error loading team. Please check your ID or try again later.";
      }
    }

    async function showPlayerInfo(elementId, name, code) {
      const infoBox = document.getElementById("player-info");
      const details = document.getElementById("player-details");
      details.innerHTML = "<p>Loading...</p>";
      infoBox.classList.add("active");

      try {
        const playerData = await fetchJSON(`https://fantasy.premierleague.com/api/element-summary/${elementId}/`);
        const latestMatch = playerData.history[playerData.history.length - 1];
        details.innerHTML = `
          <img class="player-photo" src="https://resources.premierleague.com/premierleague/photos/players/250x250/p${code}.png">
          <div class="info-line"><strong>Name:</strong> ${name}</div>
          <div class="info-line"><strong>Current GW Points:</strong> ${latestMatch?.total_points || 0}</div>
          <div class="info-line"><strong>Goals:</strong> ${latestMatch?.goals_scored || 0}</div>
          <div class="info-line"><strong>Assists:</strong> ${latestMatch?.assists || 0}</div>
          <div class="info-line"><strong>Minutes:</strong> ${latestMatch?.minutes || 0}</div>
        `;
      } catch {
        details.innerHTML = "<p>Error loading player info.</p>";
      }
    }

    function closeSidebar() {
      document.getElementById("player-info").classList.remove("active");
    }
  </script>
</body>
</html>
